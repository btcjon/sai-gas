# security-audit.formula.yaml
# AOP aspect for security scanning at implementation boundaries

formula: security-audit
type: aspect
description: |
  Cross-cutting security concern. Applies security scanning
  before and after implementation steps.

  This is an ASPECT - it doesn't run standalone. Apply it
  to other formulas using --with-aspect.
version: 1

pointcuts:
  - glob: "*.implement"
  - glob: "*.submit"

advice:
  around:
    before:
      - id: security-prescan
        description: |
          Pre-implementation security check.

          - Review for secrets/credentials in scope
          - Check dependencies for known vulnerabilities
          - Verify security requirements are understood
        args:
          target: "{step.id}"

    after:
      - id: security-postscan
        description: |
          Post-implementation security scan.

          - Scan new code for vulnerabilities (SAST)
          - Check for hardcoded secrets
          - Verify auth/authz patterns
          - Review for OWASP Top 10 issues
        args:
          target: "{step.id}"
        output:
          approved: boolean
          findings: list

      - gate:
          condition: "security-postscan.output.approved == true"
          message: "Security approval required before proceeding"
