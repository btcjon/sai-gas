# rule-of-five.formula.yaml
# Jeffrey's Rule: Agents converge on best output in 4-5 iterations
# Breadth-first cognition, then editorial passes

formula: rule-of-five
type: expansion
description: |
  Jeffrey Emanuel's discovery: LLM agents (and humans) produce their best
  work through iterative refinement. The first pass is breadth-first
  exploration; subsequent passes are editorial refinement.

  Apply this to any step that benefits from iteration:
  - Writing (code, docs, plans)
  - Analysis (reviews, investigations)
  - Design (architecture, interfaces)

  The expansion replaces one step with five sequential steps.
version: 1

# This is a macro/expansion template
# When applied to a target step, it expands to 5 steps

template:
  - id: "{target}.draft"
    description: |
      Initial attempt at: {target.description}

      Don't aim for perfection. Get the shape right.
      Breadth over depth. Explore the space.

  - id: "{target}.refine-1"
    description: |
      First refinement pass. Focus: CORRECTNESS.

      Review the draft. Fix errors, bugs, mistakes.
      Is the logic sound? Are the facts right?
    needs: ["{target}.draft"]

  - id: "{target}.refine-2"
    description: |
      Second refinement pass. Focus: CLARITY.

      Can someone else understand this?
      Simplify. Remove jargon. Add explanations where needed.
    needs: ["{target}.refine-1"]

  - id: "{target}.refine-3"
    description: |
      Third refinement pass. Focus: EDGE CASES.

      What could go wrong? What's missing?
      Handle the unusual inputs, the error paths, the corner cases.
    needs: ["{target}.refine-2"]

  - id: "{target}.refine-4"
    description: |
      Final polish. Focus: EXCELLENCE.

      This is the last pass. Make it shine.
      Is this something you'd be proud to ship?
    needs: ["{target}.refine-3"]
